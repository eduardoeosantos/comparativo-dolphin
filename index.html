<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comparativo: Corolla 2008 vs BYD Dolphin GS</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöó</text></svg>"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{background:#060d1b;font-family:'SF Pro Display','Segoe UI',-apple-system,sans-serif}
    input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:8px;background:#1a2744;border-radius:4px;outline:none;cursor:pointer;touch-action:none}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:28px;height:28px;background:linear-gradient(135deg,#3b82f6,#60a5fa);border-radius:50%;cursor:grab;border:2px solid #93c5fd;box-shadow:0 2px 8px rgba(59,130,246,0.4);transition:box-shadow 0.15s}
    input[type=range]::-webkit-slider-thumb:active{cursor:grabbing;background:linear-gradient(135deg,#2563eb,#3b82f6);box-shadow:0 0 0 8px rgba(59,130,246,0.12),0 2px 8px rgba(59,130,246,0.4)}
    input[type=range]::-moz-range-thumb{width:28px;height:28px;background:linear-gradient(135deg,#3b82f6,#60a5fa);border-radius:50%;cursor:grab;border:2px solid #93c5fd;box-shadow:0 2px 8px rgba(59,130,246,0.4)}
    input[type=checkbox]{accent-color:#22c55e;width:16px;height:16px}
    table{width:100%;border-collapse:collapse}
    button{cursor:pointer;border:none;font-family:inherit}
    button:active{transform:scale(0.97)}
    .mi{background:#111b30;border:1px solid #1a2744;border-radius:8px;color:#e2e8f0;font-size:16px;font-weight:700;padding:8px 12px;width:100%;text-align:right;outline:none;font-family:inherit}
    .mi:focus{border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,0.2)}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useCallback,useRef}=React;

/*
  FluidSlider:
  - 100% n√£o-controlado pelo React (usa defaultValue, nunca value)
  - Durante arrasto: ZERO setState. S√≥ atualiza o label via DOM ref.
  - Quando solta o mouse/dedo: a√≠ sim chama onChange ‚Üí setState ‚Üí recalcula tudo.
  - dragging ref impede qualquer update do React durante o drag.
*/
const FluidSlider=({label,initial,onChange,min,max,step,fmtLabel})=>{
  const inputRef=useRef(null);
  const labelRef=useRef(null);
  const dragging=useRef(false);

  useEffect(()=>{
    if(!dragging.current&&inputRef.current){
      inputRef.current.value=initial;
      if(labelRef.current)labelRef.current.textContent=fmtLabel(initial);
    }
  },[initial]);

  const onPointerDown=useCallback(()=>{dragging.current=true},[]);

  const onInput=useCallback(e=>{
    // S√≥ atualiza o texto ‚Äî NENHUM setState
    if(labelRef.current)labelRef.current.textContent=fmtLabel(Number(e.target.value));
  },[fmtLabel]);

  const onDone=useCallback(()=>{
    dragging.current=false;
    if(inputRef.current)onChange(Number(inputRef.current.value));
  },[onChange]);

  return(
    <div style={{marginBottom:14}}>
      <div style={{display:"flex",justifyContent:"space-between",fontSize:12,color:"#6b7f9e",marginBottom:4}}>
        <span>{label}</span>
        <span ref={labelRef} style={{color:"#e2e8f0",fontWeight:700,fontVariantNumeric:"tabular-nums"}}>{fmtLabel(initial)}</span>
      </div>
      <input ref={inputRef} type="range" min={min} max={max} step={step}
        defaultValue={initial}
        onPointerDown={onPointerDown}
        onInput={onInput}
        onMouseUp={onDone}
        onTouchEnd={onDone}
        onPointerUp={onDone}/>
    </div>
  );
};

const FluidDepSlider=({year,initial,onChange,color})=>{
  const inputRef=useRef(null);
  const labelRef=useRef(null);
  const dragging=useRef(false);

  useEffect(()=>{
    if(!dragging.current&&inputRef.current){
      inputRef.current.value=initial;
      if(labelRef.current)labelRef.current.textContent=initial.toFixed(1)+"%";
    }
  },[initial]);

  const onPointerDown=useCallback(()=>{dragging.current=true},[]);

  const onInput=useCallback(e=>{
    if(labelRef.current)labelRef.current.textContent=Number(e.target.value).toFixed(1)+"%";
  },[]);

  const onDone=useCallback(()=>{
    dragging.current=false;
    if(inputRef.current)onChange(Number(inputRef.current.value));
  },[onChange]);

  return(
    <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:6}}>
      <span style={{fontSize:11,color:"#6b7f9e",width:48,flexShrink:0}}>Ano {year}</span>
      <div style={{flex:1}}>
        <input ref={inputRef} type="range" min={0} max={20} step={0.1}
          defaultValue={initial} style={{height:6}}
          onPointerDown={onPointerDown}
          onInput={onInput}
          onMouseUp={onDone}
          onTouchEnd={onDone}
          onPointerUp={onDone}/>
      </div>
      <span ref={labelRef} style={{fontSize:12,fontWeight:700,width:42,textAlign:"right",flexShrink:0,fontVariantNumeric:"tabular-nums",color}}>{initial.toFixed(1)}%</span>
    </div>
  );
};

const App=()=>{
  const[corollaVal,setCorollaVal]=useState(50000);
  const[dolphinVal,setDolphinVal]=useState(130000);
  const[cashOut,setCashOut]=useState(80000);
  const[gasPrice,setGasPrice]=useState(6.33);
  const[elecPrice,setElecPrice]=useState(1.00);
  const[dailyKm,setDailyKm]=useState(50);
  const[corollaKmL,setCorollaKmL]=useState(10);
  const[dolphinKmKwh,setDolphinKmKwh]=useState(8.26);
  const[cdiNet,setCdiNet]=useState(10.15);
  const[dolphinIPVAExempt,setDolphinIPVAExempt]=useState(true);
  const[irMonth,setIrMonth]=useState(130);
  const[cd,setCd]=useState([2,2,2,1,1]);
  const[dd,setDd]=useState([10,8,7,6,5]);
  const[copied,setCopied]=useState(false);
  const[showShare,setShowShare]=useState(false);
  const setCdY=useCallback((i,v)=>setCd(p=>{const n=[...p];n[i]=v;return n}),[]);
  const setDdY=useCallback((i,v)=>setDd(p=>{const n=[...p];n[i]=v;return n}),[]);

  useEffect(()=>{
    try{
      const raw=window.location.search.slice(1)||window.location.hash.slice(1);
      if(!raw)return;const p=new URLSearchParams(raw);
      if(p.get("km"))setDailyKm(Number(p.get("km")));
      if(p.get("gas"))setGasPrice(Number(p.get("gas")));
      if(p.get("energia"))setElecPrice(Number(p.get("energia")));
      if(p.get("cdi"))setCdiNet(Number(p.get("cdi")));
      if(p.get("cc"))setCorollaKmL(Number(p.get("cc")));
      if(p.get("dc"))setDolphinKmKwh(Number(p.get("dc")));
      if(p.has("ipva"))setDolphinIPVAExempt(p.get("ipva")==="1");
      if(p.get("vc"))setCorollaVal(Number(p.get("vc")));
      if(p.get("vd"))setDolphinVal(Number(p.get("vd")));
      if(p.get("$"))setCashOut(Number(p.get("$")));
      if(p.get("ir"))setIrMonth(Number(p.get("ir")));
      if(p.get("cd")){try{setCd(JSON.parse(p.get("cd")))}catch(e){}}
      if(p.get("dd")){try{setDd(JSON.parse(p.get("dd")))}catch(e){}}
    }catch(e){}
  },[]);

  const genUrl=useCallback(()=>{
    const p=new URLSearchParams({
      km:dailyKm,gas:gasPrice.toFixed(2),energia:elecPrice.toFixed(2),
      cdi:cdiNet.toFixed(2),cc:corollaKmL.toFixed(1),dc:dolphinKmKwh.toFixed(2),
      ipva:dolphinIPVAExempt?"1":"0",vc:corollaVal,vd:dolphinVal,"$":cashOut,ir:irMonth,
      cd:JSON.stringify(cd),dd:JSON.stringify(dd),
    });
    return window.location.origin+window.location.pathname.replace(/\/$/,"")+"?"+p.toString();
  },[dailyKm,gasPrice,elecPrice,cdiNet,corollaKmL,dolphinKmKwh,dolphinIPVAExempt,corollaVal,dolphinVal,cashOut,irMonth,cd,dd]);

  const handleCopy=async()=>{
    try{await navigator.clipboard.writeText(genUrl())}catch{
      const t=document.createElement("textarea");t.value=genUrl();document.body.appendChild(t);t.select();document.execCommand("copy");document.body.removeChild(t);
    }
    setCopied(true);setTimeout(()=>setCopied(false),2500);
  };

  const DM=30,MY=12,CM=3500,DM2=1200,IPVAR=0.04;
  const cDL=dailyKm/corollaKmL,cDC=cDL*gasPrice,cMF=cDC*DM,cYF=cMF*MY,cKm=gasPrice/corollaKmL;
  const dDK=dailyKm/dolphinKmKwh,dDC=dDK*elecPrice,dME=dDC*DM,dYE=dME*MY,dKm=elecPrice/dolphinKmKwh;
  const fSY=cYF-dYE,irSY=irMonth*MY;
  const depFn=(init,r)=>{const v=[init];for(let i=0;i<r.length;i++)v.push(Math.round(v[i]*(1-r[i]/100)));return v};
  const cVals=depFn(corollaVal,cd),dVals=depFn(dolphinVal,dd);

  const analysis=(()=>{
    const yrs=[];let inv=cashOut,cum=0;
    for(let y=1;y<=5;y++){
      inv*=(1+cdiNet/100);
      const ipva=dolphinIPVAExempt?0:(dVals[y-1]*IPVAR);
      cum+=fSY+(CM-DM2)+irSY-ipva;
      const cdl=corollaVal-cVals[y],ddl=dolphinVal-dVals[y],ndd=ddl-cdl,oc=inv-cashOut;
      yrs.push({y,cum,cV:cVals[y],dV:dVals[y],cdl,ddl,ndd,inv:Math.round(inv),oc:Math.round(oc),net:Math.round(cum-ndd-oc)});
    }return yrs;
  })();

  const fmt=v=>v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  const fK=v=>`R$ ${(v/1000).toFixed(1)}k`;
  const beY=analysis.find(a=>a.net>0);
  const fN=analysis[4]?.net||0;
  const totalOpY=fSY+(CM-DM2)+irSY+(dolphinIPVAExempt?0:-(dolphinVal*IPVAR));

  const MI=({label,value,onChange,color})=>{
    const[raw,setRaw]=useState(value.toString());
    const[fo,setFo]=useState(false);
    useEffect(()=>{if(!fo)setRaw(value.toString())},[value,fo]);
    return(
      <div style={{flex:1,minWidth:0}}>
        <div style={{fontSize:11,color:color||"#6b7f9e",marginBottom:4,fontWeight:600}}>{label}</div>
        <div style={{position:"relative"}}>
          <span style={{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",fontSize:14,color:"#4a5e7a",fontWeight:700}}>R$</span>
          <input className="mi" style={{paddingLeft:40,borderColor:fo?(color||"#3b82f6"):"#1a2744"}}
            value={fo?raw:Number(value).toLocaleString("pt-BR")}
            onFocus={()=>{setFo(true);setRaw(value.toString())}}
            onBlur={()=>{setFo(false);const n=parseInt(raw.replace(/\D/g,""),10);if(!isNaN(n)&&n>=0)onChange(n);else setRaw(value.toString())}}
            onChange={e=>setRaw(e.target.value)}
            onKeyDown={e=>{if(e.key==="Enter")e.target.blur()}}
            inputMode="numeric"/>
        </div>
      </div>
    );
  };

  const Sec=({title,icon,children,sub})=>(
    <div style={{background:"#0c1222",borderRadius:16,padding:"20px 18px",marginBottom:18,border:"1px solid #1a2744",boxShadow:"0 4px 24px rgba(0,0,0,0.3)"}}>
      <h3 style={{margin:0,fontSize:15,color:"#7dd3fc",fontWeight:700,letterSpacing:"-0.02em",display:"flex",alignItems:"center",gap:8}}>
        <span style={{fontSize:18}}>{icon}</span>{title}
      </h3>
      {sub&&<div style={{fontSize:11,color:"#3d5278",marginTop:4}}>{sub}</div>}
      <div style={{marginTop:sub?8:16}}>{children}</div>
    </div>
  );

  const SC=({label,value,color,small})=>(
    <div style={{background:"#111b30",borderRadius:10,padding:small?10:14,textAlign:"center",flex:1,minWidth:0,border:"1px solid #1a2744"}}>
      <div style={{fontSize:10,color:"#6b7f9e",marginBottom:3,textTransform:"uppercase",letterSpacing:"0.04em"}}>{label}</div>
      <div style={{fontSize:small?16:22,fontWeight:800,color:color||"#e2e8f0",lineHeight:1.2}}>{value}</div>
    </div>
  );

  const Bar=({value,max,color})=>(
    <div style={{width:"100%",background:"#111b30",borderRadius:6,height:26,overflow:"hidden"}}>
      <div style={{width:`${Math.min(Math.abs(value)/Math.abs(max)*100,100)}%`,background:`linear-gradient(90deg,${color}88,${color})`,height:"100%",borderRadius:6,
        display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:8,fontSize:11,fontWeight:700,color:"#fff",minWidth:55}}>
        {fmt(value)}
      </div>
    </div>
  );

  const CR=({label,corolla,dolphin})=>{
    const mx=Math.max(Math.abs(corolla),Math.abs(dolphin));
    return(<div style={{marginBottom:14}}>
      <div style={{fontSize:11,color:"#6b7f9e",marginBottom:5}}>{label}</div>
      <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:4}}>
        <span style={{width:52,fontSize:10,color:"#ff6b6b",fontWeight:700}}>Corolla</span><Bar value={corolla} max={mx} color="#ef4444"/>
      </div>
      <div style={{display:"flex",gap:6,alignItems:"center"}}>
        <span style={{width:52,fontSize:10,color:"#4ade80",fontWeight:700}}>Dolphin</span><Bar value={dolphin} max={mx} color="#22c55e"/>
      </div>
    </div>);
  };

  return(
    <div style={{background:"linear-gradient(180deg,#060d1b,#0a1628)",color:"#d1dae8",minHeight:"100vh",padding:"20px 10px"}}>
      <div style={{maxWidth:660,margin:"0 auto"}}>
        <div style={{textAlign:"center",marginBottom:6,padding:"16px 0 8px"}}>
          <div style={{fontSize:11,color:"#3b5998",textTransform:"uppercase",letterSpacing:"0.15em",fontWeight:700,marginBottom:6}}>Simulador Financeiro</div>
          <h1 style={{fontSize:24,fontWeight:800,margin:"0 0 4px",letterSpacing:"-0.03em",
            background:"linear-gradient(135deg,#ff6b6b,#7dd3fc,#4ade80)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>
            Corolla SEG 2008 vs BYD Dolphin GS
          </h1>
          <p style={{fontSize:12,color:"#3d5278",margin:0}}>An√°lise completa com deprecia√ß√£o, custo de oportunidade e economia operacional</p>
        </div>

        <div style={{display:"flex",justifyContent:"center",marginBottom:18}}>
          <button onClick={()=>setShowShare(!showShare)} style={{background:"linear-gradient(135deg,#1e40af,#3b82f6)",color:"#fff",borderRadius:10,padding:"10px 20px",fontSize:13,fontWeight:700,display:"flex",alignItems:"center",gap:8,boxShadow:"0 4px 16px rgba(59,130,246,0.3)"}}>
            üîó Compartilhar Simula√ß√£o
          </button>
        </div>
        {showShare&&(
          <div style={{background:"#111b30",borderRadius:14,padding:16,marginBottom:18,border:"1px solid #1e40af"}}>
            <div style={{fontSize:12,color:"#7dd3fc",fontWeight:600,marginBottom:8}}>üìã Link com todos os seus par√¢metros:</div>
            <div style={{background:"#060d1b",borderRadius:8,padding:10,fontSize:10,color:"#6b7f9e",wordBreak:"break-all",lineHeight:1.6,border:"1px solid #1a2744",marginBottom:10}}>{genUrl()}</div>
            <div style={{display:"flex",gap:8}}>
              <button onClick={handleCopy} style={{background:copied?"#166534":"#1e40af",color:"#fff",borderRadius:8,padding:"8px 16px",fontSize:12,fontWeight:700,flex:1,transition:"all 0.3s"}}>{copied?"‚úÖ Copiado!":"üìã Copiar Link"}</button>
              <button onClick={()=>setShowShare(false)} style={{background:"#1a2744",color:"#6b7f9e",border:"1px solid #2a3f5f",borderRadius:8,padding:"8px 16px",fontSize:12}}>Fechar</button>
            </div>
          </div>
        )}

        <Sec title="Valores da Opera√ß√£o" icon="üíµ" sub="Digite os valores reais do seu cen√°rio">
          <div style={{display:"flex",gap:12,marginBottom:14}}>
            <MI label="üî¥ Valor do Corolla (venda)" value={corollaVal} onChange={setCorollaVal} color="#ff6b6b"/>
            <MI label="üü¢ Pre√ßo do Dolphin (compra)" value={dolphinVal} onChange={setDolphinVal} color="#4ade80"/>
          </div>
          <div style={{display:"flex",gap:12,marginBottom:10}}>
            <MI label="üí∞ Dinheiro do bolso" value={cashOut} onChange={setCashOut} color="#facc15"/>
            <MI label="üìã IR aux√≠lio/m√™s" value={irMonth} onChange={setIrMonth} color="#7dd3fc"/>
          </div>
          <div style={{background:"#0d1f3c",borderRadius:10,padding:10,fontSize:11,color:"#7dd3fc",border:"1px solid #1e3a5f",lineHeight:1.8}}>
            üí° Total: <b>{fmt(corollaVal)}</b> + <b>{fmt(cashOut)}</b> = <b>{fmt(corollaVal+cashOut)}</b>
            {corollaVal+cashOut!==dolphinVal&&(
              <span style={{color:corollaVal+cashOut>dolphinVal?"#4ade80":"#ff6b6b"}}>
                {" "}({corollaVal+cashOut>dolphinVal?"sobra":"faltam"} <b>{fmt(Math.abs(corollaVal+cashOut-dolphinVal))}</b>)
              </span>
            )}
            {corollaVal+cashOut===dolphinVal&&<span style={{color:"#4ade80"}}> ‚úÖ Valor exato</span>}
          </div>
        </Sec>

        <Sec title="Par√¢metros Operacionais" icon="‚öôÔ∏è" sub="Arraste para ajustar ‚Äî os c√°lculos atualizam ao soltar">
          <FluidSlider label="Km rodados por dia" initial={dailyKm} onChange={setDailyKm} min={10} max={200} step={1} fmtLabel={v=>`${v} km`}/>
          <FluidSlider label="Pre√ßo da gasolina" initial={gasPrice} onChange={setGasPrice} min={4} max={10} step={0.01} fmtLabel={v=>`R$ ${v.toFixed(2)}/l`}/>
          <FluidSlider label="Tarifa de energia" initial={elecPrice} onChange={setElecPrice} min={0.30} max={1.80} step={0.01} fmtLabel={v=>`R$ ${v.toFixed(2)}/kWh`}/>
          <FluidSlider label="CDI l√≠quido (ap√≥s IR)" initial={cdiNet} onChange={setCdiNet} min={4} max={16} step={0.01} fmtLabel={v=>`${v.toFixed(2)}% a.a.`}/>
          <FluidSlider label="Consumo Corolla" initial={corollaKmL} onChange={setCorollaKmL} min={5} max={18} step={0.1} fmtLabel={v=>`${v.toFixed(1)} km/l`}/>
          <FluidSlider label="Consumo Dolphin" initial={dolphinKmKwh} onChange={setDolphinKmKwh} min={4} max={12} step={0.01} fmtLabel={v=>`${v.toFixed(2)} km/kWh`}/>
          <label style={{fontSize:12,color:"#6b7f9e",display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginTop:4}}>
            <input type="checkbox" checked={dolphinIPVAExempt} onChange={e=>setDolphinIPVAExempt(e.target.checked)}/>
            IPVA do Dolphin isento no seu estado?
          </label>
        </Sec>

        <Sec title="Deprecia√ß√£o Anual Ajust√°vel" icon="üìâ" sub="Deslize para simular cen√°rios ‚Äî valores atualizam ao soltar">
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16}}>
            <div>
              <div style={{fontSize:13,fontWeight:700,color:"#ff6b6b",marginBottom:8,display:"flex",justifyContent:"space-between"}}>
                <span>üî¥ Corolla</span>
                <span style={{fontSize:11,color:"#6b7f9e",fontWeight:400}}>M√©dia: {((cd[0]+cd[1]+cd[2]+cd[3]+cd[4])/5).toFixed(1)}%</span>
              </div>
              {cd.map((v,i)=><FluidDepSlider key={`c${i}`} year={i+1} initial={v} onChange={val=>setCdY(i,val)} color="#ff6b6b"/>)}
            </div>
            <div>
              <div style={{fontSize:13,fontWeight:700,color:"#4ade80",marginBottom:8,display:"flex",justifyContent:"space-between"}}>
                <span>üü¢ Dolphin</span>
                <span style={{fontSize:11,color:"#6b7f9e",fontWeight:400}}>M√©dia: {((dd[0]+dd[1]+dd[2]+dd[3]+dd[4])/5).toFixed(1)}%</span>
              </div>
              {dd.map((v,i)=><FluidDepSlider key={`d${i}`} year={i+1} initial={v} onChange={val=>setDdY(i,val)} color="#4ade80"/>)}
            </div>
          </div>
          <div style={{overflowX:"auto",marginTop:16}}>
            <table>
              <thead><tr style={{borderBottom:"2px solid #1a2744"}}>
                <th style={{padding:"6px 4px",textAlign:"left",color:"#3d5278",fontSize:10}}>Ano</th>
                <th style={{padding:"6px 4px",textAlign:"center",color:"#ff6b6b",fontSize:10}}>Corolla</th>
                <th style={{padding:"6px 4px",textAlign:"center",color:"#ff6b6b",fontSize:10}}>Perda</th>
                <th style={{padding:"6px 4px",textAlign:"center",color:"#4ade80",fontSize:10}}>Dolphin</th>
                <th style={{padding:"6px 4px",textAlign:"center",color:"#4ade80",fontSize:10}}>Perda</th>
                <th style={{padding:"6px 4px",textAlign:"center",color:"#7dd3fc",fontSize:10}}>Diff.</th>
              </tr></thead>
              <tbody>
                <tr style={{borderBottom:"1px solid #111b30"}}>
                  <td style={{padding:"6px 4px",color:"#6b7f9e"}}>Hoje</td>
                  <td style={{padding:"6px 4px",textAlign:"center",fontWeight:700}}>{fK(corollaVal)}</td>
                  <td style={{padding:"6px 4px",textAlign:"center",color:"#3d5278"}}>‚Äî</td>
                  <td style={{padding:"6px 4px",textAlign:"center",fontWeight:700}}>{fK(dolphinVal)}</td>
                  <td style={{padding:"6px 4px",textAlign:"center",color:"#3d5278"}}>‚Äî</td>
                  <td style={{padding:"6px 4px",textAlign:"center",color:"#3d5278"}}>‚Äî</td>
                </tr>
                {analysis.map(a=>(
                  <tr key={a.y} style={{borderBottom:"1px solid #111b30"}}>
                    <td style={{padding:"6px 4px",color:"#6b7f9e",fontWeight:600}}>Ano {a.y}</td>
                    <td style={{padding:"6px 4px",textAlign:"center",fontWeight:600,color:"#fca5a5"}}>{fK(a.cV)}</td>
                    <td style={{padding:"6px 4px",textAlign:"center",fontSize:10,color:"#dc2626"}}>-{fK(a.cdl)}</td>
                    <td style={{padding:"6px 4px",textAlign:"center",fontWeight:600,color:"#86efac"}}>{fK(a.dV)}</td>
                    <td style={{padding:"6px 4px",textAlign:"center",fontSize:10,color:"#dc2626"}}>-{fK(a.ddl)}</td>
                    <td style={{padding:"6px 4px",textAlign:"center",fontSize:10,fontWeight:700,color:"#facc15"}}>-{fK(a.ndd)}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          <div style={{background:"#1a1a0a",borderRadius:10,padding:10,marginTop:10,fontSize:11,color:"#facc15",border:"1px solid #854d0e30"}}>
            ‚ö†Ô∏è Em 5 anos: Dolphin perde <b>{fK(analysis[4].ddl)}</b> vs <b>{fK(analysis[4].cdl)}</b> do Corolla. Diferen√ßa: <b>{fK(analysis[4].ndd)}</b>.
          </div>
        </Sec>

        <Sec title="Custos com Combust√≠vel / Energia" icon="‚õΩ">
          <CR label={`Custo di√°rio (${dailyKm} km)`} corolla={cDC} dolphin={dDC}/>
          <CR label="Custo mensal" corolla={cMF} dolphin={dME}/>
          <CR label="Custo anual" corolla={cYF} dolphin={dYE}/>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginTop:12}}>
            <SC label="R$/km Corolla" value={`R$ ${cKm.toFixed(2)}`} color="#ff6b6b" small/>
            <SC label="R$/km Dolphin" value={`R$ ${dKm.toFixed(2)}`} color="#4ade80" small/>
            <SC label="Vezes mais barato" value={`${(cKm/dKm).toFixed(1)}x`} color="#7dd3fc" small/>
          </div>
          <div style={{background:"linear-gradient(135deg,#052e16,#0c1222)",borderRadius:12,padding:14,marginTop:14,textAlign:"center",border:"1px solid #16a34a30"}}>
            <div style={{fontSize:11,color:"#6ee7b7"}}>Economia anual combust√≠vel ‚Üí energia</div>
            <div style={{fontSize:28,fontWeight:800,color:"#4ade80"}}>{fmt(fSY)}</div>
          </div>
        </Sec>

        <Sec title="Economia Operacional Anual" icon="üí∞">
          {[
            {l:"Economia combust√≠vel ‚Üí energia",v:fSY,c:"#4ade80"},
            {l:"Economia manuten√ß√£o",v:CM-DM2,c:"#4ade80"},
            {l:`Economia IR aux√≠lio (${fmt(irMonth)}/m√™s)`,v:irSY,c:"#4ade80"},
            {l:"IPVA Dolphin",v:dolphinIPVAExempt?0:-(dolphinVal*IPVAR),c:dolphinIPVAExempt?"#4ade80":"#ff6b6b"},
          ].map((it,i)=>(
            <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",background:"#111b30",borderRadius:8,padding:"9px 14px",marginBottom:6,border:"1px solid #1a2744"}}>
              <span style={{fontSize:12,color:"#6b7f9e"}}>{it.l}</span>
              <span style={{fontSize:14,fontWeight:700,color:it.c}}>{it.v>=0?"+":""}{fmt(it.v)}</span>
            </div>
          ))}
          <div style={{background:"linear-gradient(135deg,#0c1e3d,#0c1222)",borderRadius:12,padding:14,marginTop:10,textAlign:"center",border:"1px solid #1e40af30"}}>
            <div style={{fontSize:11,color:"#93c5fd"}}>Total economia operacional por ano</div>
            <div style={{fontSize:28,fontWeight:800,color:"#7dd3fc"}}>{fmt(totalOpY)}</div>
            <div style={{fontSize:11,color:"#3d5278"}}>{fmt(totalOpY/12)}/m√™s</div>
          </div>
        </Sec>

        <Sec title={`Custo de Oportunidade (${fmt(cashOut)})`} icon="üìä" sub={`Se os ${fK(cashOut)} ficassem investidos a ${cdiNet.toFixed(2)}% a.a. l√≠quido:`}>
          <div style={{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6}}>
            {analysis.map(a=>(
              <div key={a.y} style={{background:"#111b30",borderRadius:10,padding:8,textAlign:"center",border:"1px solid #1a2744"}}>
                <div style={{fontSize:10,color:"#3d5278"}}>Ano {a.y}</div>
                <div style={{fontSize:13,fontWeight:800,color:"#facc15"}}>{fK(a.inv)}</div>
                <div style={{fontSize:9,color:"#854d0e"}}>+{fK(a.oc)}</div>
              </div>
            ))}
          </div>
        </Sec>

        <Sec title="Balan√ßo Final ‚Äî Proje√ß√£o 5 Anos" icon="üèÜ" sub="Economia ‚àí Deprecia√ß√£o extra ‚àí Custo de oportunidade">
          <div style={{overflowX:"auto"}}>
            <table>
              <thead><tr style={{borderBottom:"2px solid #1a2744"}}>
                <th style={{padding:"8px 3px",textAlign:"left",color:"#3d5278",fontSize:10}}>Ano</th>
                <th style={{padding:"8px 3px",textAlign:"center",color:"#4ade80",fontSize:10}}>Econ.<br/>Operac.</th>
                <th style={{padding:"8px 3px",textAlign:"center",color:"#ff6b6b",fontSize:10}}>Deprec.<br/>Extra</th>
                <th style={{padding:"8px 3px",textAlign:"center",color:"#facc15",fontSize:10}}>Custo<br/>Oportun.</th>
                <th style={{padding:"8px 3px",textAlign:"center",color:"#7dd3fc",fontSize:10}}>Saldo<br/>L√≠quido</th>
              </tr></thead>
              <tbody>
                {analysis.map(a=>(
                  <tr key={a.y} style={{borderBottom:"1px solid #111b30"}}>
                    <td style={{padding:"8px 3px",color:"#6b7f9e",fontWeight:700}}>Ano {a.y}</td>
                    <td style={{padding:"8px 3px",textAlign:"center",color:"#4ade80",fontWeight:700}}>+{fK(a.cum)}</td>
                    <td style={{padding:"8px 3px",textAlign:"center",color:"#ff6b6b",fontWeight:700}}>-{fK(a.ndd)}</td>
                    <td style={{padding:"8px 3px",textAlign:"center",color:"#facc15",fontWeight:700}}>-{fK(a.oc)}</td>
                    <td style={{padding:"8px 3px",textAlign:"center",fontWeight:800,fontSize:13,color:a.net>=0?"#4ade80":"#ff6b6b"}}>
                      {a.net>=0?"+":""}{fK(a.net)}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          <div style={{
            background:fN>=0?"linear-gradient(135deg,#052e16,#0c1222)":"linear-gradient(135deg,#2a0a0a,#0c1222)",
            borderRadius:14,padding:20,marginTop:16,textAlign:"center",
            border:`1px solid ${fN>=0?"#22c55e":"#ef4444"}30`,
            boxShadow:`0 8px 32px ${fN>=0?"rgba(34,197,94,0.1)":"rgba(239,68,68,0.1)"}`}}>
            <div style={{fontSize:12,color:fN>=0?"#6ee7b7":"#fca5a5",marginBottom:4}}>Resultado l√≠quido em 5 anos</div>
            <div style={{fontSize:34,fontWeight:800,color:fN>=0?"#4ade80":"#ff6b6b",letterSpacing:"-0.02em"}}>{fN>=0?"+":""}{fmt(fN)}</div>
            {beY?(<div style={{fontSize:12,color:"#6ee7b7",marginTop:6}}>‚úÖ Payback no <b>ano {beY.y}</b></div>)
            :(<div style={{fontSize:12,color:"#fca5a5",marginTop:6}}>‚è≥ N√£o atinge payback em 5 anos</div>)}
          </div>
        </Sec>

        <Sec title="Equival√™ncia Pr√°tica" icon="üîÑ">
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
            {[
              {i:"‚õΩ",t:`${dailyKm}km Corolla`,tx:`${cDL.toFixed(1)}L = ${fmt(cDC)}/dia`,c:"#ff6b6b"},
              {i:"‚ö°",t:`${dailyKm}km Dolphin`,tx:`${dDK.toFixed(1)}kWh = ${fmt(dDC)}/dia`,c:"#4ade80"},
              {i:"üîã",t:"Frequ√™ncia recarga",tx:`~${Math.floor(291/dailyKm)} dias com ${dailyKm}km/dia`,c:"#7dd3fc"},
              {i:"üí°",t:"Equiv. gasolina",tx:`Dolphin ‚âà ${(gasPrice/dKm).toFixed(0)} km/l`,c:"#facc15"},
            ].map((it,i)=>(
              <div key={i} style={{background:"#111b30",borderRadius:10,padding:12,border:"1px solid #1a2744"}}>
                <div style={{fontSize:12,color:it.c,fontWeight:700,marginBottom:3}}>{it.i} {it.t}</div>
                <div style={{fontSize:12,color:"#6b7f9e"}}>{it.tx}</div>
              </div>
            ))}
          </div>
        </Sec>

        <Sec title="An√°lise e Insights" icon="üß†">
          <div style={{fontSize:12,color:"#6b7f9e",lineHeight:1.9}}>
            <div style={{background:"#0a1a12",borderRadius:10,padding:14,marginBottom:8,border:"1px solid #16a34a20"}}>
              <b style={{color:"#4ade80"}}>‚úÖ Vantagens do Dolphin:</b><br/>
              ‚Ä¢ Economia operacional de ~{fmt(totalOpY)}/ano<br/>
              ‚Ä¢ Custo por km {(cKm/dKm).toFixed(1)}x menor<br/>
              ‚Ä¢ Garantia 6 anos ve√≠culo / 8 anos bateria<br/>
              ‚Ä¢ {fmt(irSY)}/ano economia IR aux√≠lio
            </div>
            <div style={{background:"#1a0a0a",borderRadius:10,padding:14,marginBottom:8,border:"1px solid #dc262620"}}>
              <b style={{color:"#ff6b6b"}}>‚ö†Ô∏è Riscos:</b><br/>
              ‚Ä¢ {fmt(cashOut)} do bolso (oportunidade ~{fmt(analysis[4].oc)} em 5a)<br/>
              ‚Ä¢ Dolphin deprecia ~{fK(analysis[4].ddl)} vs ~{fK(analysis[4].cdl)} Corolla<br/>
              ‚Ä¢ Incerteza revenda EV no Brasil<br/>
              ‚Ä¢ Seguro do Dolphin mais caro
            </div>
            <div style={{background:"#0c1e3d",borderRadius:10,padding:14,border:"1px solid #1e40af20"}}>
              <b style={{color:"#7dd3fc"}}>üí° Melhora se:</b><br/>
              ‚Ä¢ Mais km/dia ‚Ä¢ Gasolina subir<br/>
              ‚Ä¢ Dolphin depreciar menos ‚Ä¢ CDI cair<br/>
              ‚Ä¢ Menos dinheiro do bolso
            </div>
          </div>
        </Sec>

        <Sec title="Premissas" icon="üìù">
          <div style={{fontSize:10,color:"#3d5278",lineHeight:2}}>
            ‚Ä¢ Manuten√ß√£o Corolla: ~R$3.500/ano | Dolphin: ~R$1.200/ano<br/>
            ‚Ä¢ N√£o inclui: seguro, pneus, wallbox<br/>
            ‚Ä¢ Deprecia√ß√£o configur√°vel via sliders<br/>
            ‚Ä¢ CDI l√≠quido: {cdiNet.toFixed(2)}% a.a. (p√≥s-IR)<br/>
            ‚Ä¢ Fonte: ANP, ANEEL, FIPE ‚Ä¢ Fev/2026
          </div>
        </Sec>

        <div style={{textAlign:"center",fontSize:10,color:"#1a2744",paddingBottom:20}}>Comparativo personalizado ‚Ä¢ Fev/2026</div>
      </div>
    </div>
  );
};
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
